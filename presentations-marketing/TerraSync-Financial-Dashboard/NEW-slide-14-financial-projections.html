<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TerraSync - Slide 14: Financial Projections</title>
    <link rel="stylesheet" href="terrasync-slides-shared.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .slide {
            padding-top: 60px !important;
            padding-bottom: 20px !important;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .main-message {
            max-width: 800px;
            text-align: center;
        }

        .content-layout {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 60px;
            max-width: 1200px;
            margin: 0 auto;
            flex: 1;
        }

        .chart-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        .metrics-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .metrics-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .metrics-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: #22c55e;
            text-transform: uppercase;
        }

        .revenue-headline {
            font-size: 3.5rem;
            font-weight: 900;
            color: #22c55e;
            margin-bottom: 15px;
            line-height: 1.1;
            text-transform: uppercase;
            letter-spacing: -0.02em;
        }

        .revenue-subtitle {
            font-size: 1.4rem;
            color: #e5e7eb;
            font-weight: 800;
            margin-bottom: 20px;
            line-height: 1.2;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            letter-spacing: 0.02em;
        }

        .key-metrics-simple {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .metric-box {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(31, 41, 55, 0.6);
            border: 1px solid rgba(34, 197, 94, 0.3);
            border-radius: 16px;
            padding: 20px 25px;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .metric-box:hover {
            background: rgba(31, 41, 55, 0.8);
            border-color: rgba(34, 197, 94, 0.5);
            transform: translateY(-2px);
        }

        .metric-info {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .metric-number {
            font-size: 2.4rem;
            font-weight: 800;
            color: #22c55e;
            margin-bottom: 4px;
        }

        .metric-label {
            font-size: 1rem;
            color: #9ca3af;
            font-weight: 500;
        }

        .metric-icon {
            font-size: 1.5rem;
            color: #22c55e;
            opacity: 0.7;
        }

        .chart-section {
            display: flex;
            align-items: flex-start;
            justify-content: center;
            gap: 25px;
        }

        .chart-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: #22c55e;
            margin-bottom: 20px;
            text-transform: uppercase;
            text-align: center;
        }

        .growth-visual {
            display: flex;
            align-items: end;
            justify-content: center;
            gap: 25px;
        }

        .growth-bar {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .bar {
            width: 70px;
            border-radius: 12px;
            position: relative;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);
            gap: 2px;
            padding: 2px;
        }

        .bar:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(34, 197, 94, 0.4);
        }

        /* Pill-styled segments */
        .bar-segment {
            width: 100%;
            transition: all 0.3s ease;
            border-radius: 8px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 700;
            color: white;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
            min-height: 8px;
        }

        .bar-segment:hover {
            transform: scale(1.02);
        }

        .service-segment { background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); }
        .installation-segment { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); }
        .product-segment { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
        .saas-segment { background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); }

        .bar-2025 { height: 80px; }
        .bar-2026 { height: 200px; }
        .bar-2027 { height: 320px; }
        .bar-2028 { height: 400px; }
        .bar-2029 { height: 480px; }

        .bar-value {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1rem;
            font-weight: 700;
            color: #22c55e;
            white-space: nowrap;
        }

        .bar-year {
            font-size: 0.9rem;
            color: #9ca3af;
            font-weight: 600;
        }

        .revenue-legend {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-right: 15px;
            background: rgba(31, 41, 55, 0.6);
            border: 1px solid rgba(34, 197, 94, 0.3);
            border-radius: 12px;
            padding: 16px;
            backdrop-filter: blur(10px);
        }

        .legend-title {
            font-size: 0.9rem;
            font-weight: 700;
            color: #e5e7eb;
            margin-bottom: 6px;
            text-align: left;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.8rem;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 6px;
        }

        .legend-label {
            color: #d1d5db;
            font-weight: 500;
        }

        .chart-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: #22c55e;
            margin-bottom: 15px;
            text-transform: uppercase;
        }

        .dashboard-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(31, 41, 55, 0.8);
            border: 2px solid rgba(34, 197, 94, 0.4);
            color: #22c55e;
            padding: 10px 20px;
            border-radius: 12px;
            text-decoration: none;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .dashboard-link:hover {
            background: rgba(34, 197, 94, 0.1);
            border-color: #22c55e;
            transform: translateY(-2px);
        }

        .dashboard-link i {
            font-size: 1rem;
        }
    </style>
</head>
<body>
    <div class="slide">
        <div class="slide-content">
            <div class="slide-header">
                <h1 class="slide-title">Financial Projections</h1>
            </div>

            <div class="main-message">
                <p class="revenue-subtitle">32 territories by 2029</p>
            </div>

            <div class="content-layout">
                <div class="chart-container">
                    <div class="chart-title">Annual Revenue by Stream</div>
                    <div class="chart-section">
                        <div class="revenue-legend">
                            <div class="legend-title">Revenue Types</div>
                            <div class="legend-item">
                                <div class="legend-color saas-segment"></div>
                                <div class="legend-label">SaaS</div>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color product-segment"></div>
                                <div class="legend-label">Product</div>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color installation-segment"></div>
                                <div class="legend-label">Installation</div>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color service-segment"></div>
                                <div class="legend-label">Service</div>
                            </div>
                        </div>
                        
                        <div class="growth-visual" id="revenue-chart">
                            <div class="growth-bar">
                                <div class="bar bar-2025">
                                    <div class="bar-value" id="revenue-2025">$1.8M</div>
                                    <div class="bar-segment saas-segment" id="saas-2025"></div>
                                    <div class="bar-segment product-segment" id="product-2025"></div>
                                    <div class="bar-segment installation-segment" id="installation-2025"></div>
                                    <div class="bar-segment service-segment" id="service-2025"></div>
                                </div>
                                <div class="bar-year">2025</div>
                            </div>
                            <div class="growth-bar">
                                <div class="bar bar-2026">
                                    <div class="bar-value" id="revenue-2026">$6.2M</div>
                                    <div class="bar-segment saas-segment" id="saas-2026"></div>
                                    <div class="bar-segment product-segment" id="product-2026"></div>
                                    <div class="bar-segment installation-segment" id="installation-2026"></div>
                                    <div class="bar-segment service-segment" id="service-2026"></div>
                                </div>
                                <div class="bar-year">2026</div>
                            </div>
                            <div class="growth-bar">
                                <div class="bar bar-2027">
                                    <div class="bar-value" id="revenue-2027">$12.4M</div>
                                    <div class="bar-segment saas-segment" id="saas-2027"></div>
                                    <div class="bar-segment product-segment" id="product-2027"></div>
                                    <div class="bar-segment installation-segment" id="installation-2027"></div>
                                    <div class="bar-segment service-segment" id="service-2027"></div>
                                </div>
                                <div class="bar-year">2027</div>
                            </div>
                            <div class="growth-bar">
                                <div class="bar bar-2028">
                                    <div class="bar-value" id="revenue-2028">$16.8M</div>
                                    <div class="bar-segment saas-segment" id="saas-2028"></div>
                                    <div class="bar-segment product-segment" id="product-2028"></div>
                                    <div class="bar-segment installation-segment" id="installation-2028"></div>
                                    <div class="bar-segment service-segment" id="service-2028"></div>
                                </div>
                                <div class="bar-year">2028</div>
                            </div>
                            <div class="growth-bar">
                                <div class="bar bar-2029">
                                    <div class="bar-value" id="revenue-2029">$20.2M</div>
                                    <div class="bar-segment saas-segment" id="saas-2029"></div>
                                    <div class="bar-segment product-segment" id="product-2029"></div>
                                    <div class="bar-segment installation-segment" id="installation-2029"></div>
                                    <div class="bar-segment service-segment" id="service-2029"></div>
                                </div>
                                <div class="bar-year">2029</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="metrics-container">
                    <div class="metrics-header">
                        <div class="metrics-title">Key Metrics</div>
                        <!-- View Live Model - TEMPORARILY DISABLED -->
                        <!-- <a href="dashboard.html" class="dashboard-link" onclick="sessionStorage.setItem('terrasyncAuth', 'true')">
                            <i class="fas fa-chart-line"></i>
                            View Live Model
                        </a> -->
                    </div>
                    
                    <div class="key-metrics-simple">
                        <div class="metric-box">
                            <div class="metric-info">
                                <div class="metric-number" id="acv-metric">$35K</div>
                                <div class="metric-label">Annual Contract Value</div>
                            </div>
                            <div class="metric-icon">
                                <i class="fas fa-file-contract"></i>
                            </div>
                        </div>
                        <div class="metric-box">
                            <div class="metric-info">
                                <div class="metric-number" id="ltv-cac-metric">23.6:1</div>
                                <div class="metric-label">LTV:CAC Ratio</div>
                            </div>
                            <div class="metric-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                        </div>
                        <div class="metric-box">
                            <div class="metric-info">
                                <div class="metric-number" id="profit-margin-metric">62%</div>
                                <div class="metric-label">Profit Margin</div>
                            </div>
                            <div class="metric-icon">
                                <i class="fas fa-percentage"></i>
                            </div>
                        </div>
                        
                    </div>
                </div>
            </div>
    </div>

    <!-- Include the financial model files -->
    <script src="js/model-assumptions.js"></script>
    <script src="js/personnel-model.js"></script>
    <script src="js/financial-model-v2.js"></script>
    <script src="js/enhanced-cost-integration.js"></script>
    
    <script>
        // Financial model calculations using EXACT same logic as financial summary
        function calculateExactMetrics() {
            try {
                // Initialize the same model as financial summary
                const model = new FinancialModelV2(assumptions);
                const projections = model.runSimulation(60);
                
                console.log('Projections loaded:', projections.length);
                
                // Create annual totals using EXACT same logic as financial summary
                const startDate = new Date('2025-05-01');
                const annualTotals = {};
                
                // Initialize annual totals for each year
                for (let year = 2025; year <= 2029; year++) {
                    annualTotals[year] = {
                        service: 0,
                        installation: 0,
                        product: 0,
                        saas: 0,
                        totalRevenue: 0
                    };
                }
                
                // Accumulate totals using same logic as financial summary
                projections.forEach((p, index) => {
                    const currentDate = new Date(startDate);
                    currentDate.setMonth(startDate.getMonth() + index);
                    const year = currentDate.getFullYear();
                    
                    if (annualTotals[year]) {
                        // Use EXACT same revenue structure as financial summary
                        annualTotals[year].service += p.revenues.recurring.service;
                        annualTotals[year].installation += p.revenues.oneTime.installation;
                        annualTotals[year].product += p.revenues.oneTime.product;
                        annualTotals[year].saas += p.revenues.recurring.saas;
                        annualTotals[year].totalRevenue += p.revenues.total;
                    }
                });
                
                // Update revenue bars with exact data and stacked visualization
                for (let year = 2025; year <= 2029; year++) {
                    const data = annualTotals[year];
                    if (!data) continue;
                    
                    const total = data.totalRevenue;
                    
                    // Update total revenue
                    const revenueElement = document.getElementById(`revenue-${year}`);
                    if (revenueElement) {
                        revenueElement.textContent = `$${(total / 1000000).toFixed(1)}M`;
                    }
                    
                    // Calculate percentages for stacked segments
                    if (total > 0) {
                        const servicePercent = (data.service / total) * 100;
                        const installationPercent = (data.installation / total) * 100;
                        const productPercent = (data.product / total) * 100;
                        const saasPercent = (data.saas / total) * 100;
                        
                        // Update stacked segments with percentages (order: service bottom, installation, product, saas top)
                        const serviceElement = document.getElementById(`service-${year}`);
                        if (serviceElement) {
                            serviceElement.style.height = `${servicePercent}%`;
                            serviceElement.textContent = `${servicePercent.toFixed(0)}%`;
                        }
                        
                        const installationElement = document.getElementById(`installation-${year}`);
                        if (installationElement) {
                            installationElement.style.height = `${installationPercent}%`;
                            installationElement.textContent = installationPercent >= 8 ? `${installationPercent.toFixed(0)}%` : '';
                        }
                        
                        const productElement = document.getElementById(`product-${year}`);
                        if (productElement) {
                            productElement.style.height = `${productPercent}%`;
                            productElement.textContent = productPercent >= 8 ? `${productPercent.toFixed(0)}%` : '';
                        }
                        
                        const saasElement = document.getElementById(`saas-${year}`);
                        if (saasElement) {
                            saasElement.style.height = `${saasPercent}%`;
                            saasElement.textContent = saasPercent >= 8 ? `${saasPercent.toFixed(0)}%` : '';
                        }
                    }
                    
                    console.log(`${year} Revenue: $${(total/1000000).toFixed(1)}M (Service: $${(data.service/1000000).toFixed(1)}M [${(data.service/total*100).toFixed(1)}%], Installation: $${(data.installation/1000000).toFixed(1)}M [${(data.installation/total*100).toFixed(1)}%], Product: $${(data.product/1000000).toFixed(1)}M [${(data.product/total*100).toFixed(1)}%], SaaS: $${(data.saas/1000000).toFixed(1)}M [${(data.saas/total*100).toFixed(1)}%])`);
                }
                
                // Calculate key metrics using EXACT same logic as dashboard (using 2029 data)
                const currentYear = 2029; // Use 2029 to match what user sees in live model
                const yearProjections = projections.filter(p => {
                    const date = new Date('2025-04-01T00:00:00Z');
                    date.setUTCMonth(date.getUTCMonth() + p.month);
                    return date.getUTCFullYear() === currentYear;
                });
                
                console.log(`\n=== METRICS CALCULATION (Using ${currentYear} data - matching live model year 5) ===`);
                
                if (yearProjections.length > 0) {
                    // --- ACCURATE UNIT ECONOMICS (LTV & CAC) --- (copied from dashboard)
                    const annualAcquisitionCosts = yearProjections.reduce((sum, p) => sum + p.costs.breakdown.totalAcquisitionCosts, 0);
                    const grossNewClientsThisYear = yearProjections.reduce((sum, p) => sum + p.newClientsAcquired, 0);
                    const cac = grossNewClientsThisYear > 0 ? annualAcquisitionCosts / grossNewClientsThisYear : 0;
                    
                    const yearStartMonth = (currentYear - 2025) * 12;
                    const clientsAtYearStart = projections[yearStartMonth > 0 ? yearStartMonth - 1 : 0].clients;
                    const clientsAtYearEnd = yearProjections[yearProjections.length - 1].clients;
                    const averageClientsThisYear = (clientsAtYearStart + clientsAtYearEnd) / 2;
                    
                    const annualRecurringRevenue = yearProjections.reduce((sum, p) => sum + p.revenues.recurring.service + p.revenues.recurring.saas, 0);
                    const arpa = averageClientsThisYear > 0 ? annualRecurringRevenue / averageClientsThisYear : 0;
                    
                    // Calculate GROSS MARGIN the same way as dashboard (on recurring revenue only)
                    const annualGrossProfitOnRecurring = yearProjections.reduce((sum, p) => 
                        sum + 
                        (p.revenues.recurring.service * assumptions.margins.service) + 
                        (p.revenues.recurring.saas * assumptions.margins.saas), 0);
                    const grossMargin = annualRecurringRevenue > 0 ? annualGrossProfitOnRecurring / annualRecurringRevenue : 0;
                    
                    // Also calculate profit margin for reference
                    const annualGrossRevenue = yearProjections.reduce((sum, p) => sum + p.revenues.total, 0);
                    const annualTotalCosts = yearProjections.reduce((sum, p) => sum + p.costs.totalCosts, 0);
                    const annualNetProfit = annualGrossRevenue - annualTotalCosts;
                    const profitMargin = annualGrossRevenue > 0 ? (annualNetProfit / annualGrossRevenue) : 0;
                    
                    const annualChurnRate = assumptions.churnRateSchedule[currentYear] || 0.005;
                    
                    // --- LTV Calculation with Lifetime Cap --- (copied from dashboard)
                    const lifetimeFromChurn = annualChurnRate > 0 ? 1 / annualChurnRate : 0;
                    const effectiveLifetime = Math.min(lifetimeFromChurn, 7); // Cap lifetime at 7 years
                    const ltv = arpa * grossMargin * effectiveLifetime;
                    
                    const ltvCacRatio = cac > 0 ? ltv / cac : 0;
                    
                    // Update key metrics using EXACT same logic as dashboard
                    document.getElementById('acv-metric').textContent = `${(arpa / 1000).toFixed(0)}K`;
                    document.getElementById('ltv-cac-metric').textContent = `${ltvCacRatio.toFixed(1)}:1`;
                    document.getElementById('profit-margin-metric').textContent = `${(profitMargin * 100).toFixed(1)}%`;

                    // Calculate and display 2029 ARR
                    const lastMonth2029 = projections[projections.length - 1];
                    const arr2029 = lastMonth2029.revenues.recurring.service * 12 + lastMonth2029.revenues.recurring.saas * 12;
                    document.getElementById('arr-2029-metric').textContent = `${(arr2029 / 1000000).toFixed(1)}M`;
                    
                    console.log(`\n=== FINAL METRICS (2029 - matching live model) ===`);
                    console.log(`ACV (ARPA): $${(arpa/1000).toFixed(0)}K`);
                    console.log(`LTV:CAC: ${ltvCacRatio.toFixed(1)}:1`);
                    console.log(`Profit Margin: ${(profitMargin*100).toFixed(0)}%`);
                    console.log(`\n=== 2029 DEBUG INFO ===`);
                    console.log(`Annual Recurring Revenue: $${annualRecurringRevenue.toLocaleString()}`);
                    console.log(`Average Clients: ${averageClientsThisYear.toFixed(1)}`);
                    console.log(`CAC: $${cac.toLocaleString()}`);
                    console.log(`LTV: $${ltv.toLocaleString()}`);
                    console.log(`Effective Lifetime: ${effectiveLifetime.toFixed(1)} years`);
                    console.log(`Annual Churn Rate: ${(annualChurnRate*100).toFixed(1)}%`);
                }
                
                // Update main revenue headline with total 5-year projection
                const totalFiveYearRevenue = Object.values(annualTotals).reduce((sum, data) => sum + data.totalRevenue, 0);
                document.querySelector('.revenue-headline').textContent = `$${(totalFiveYearRevenue / 1000000).toFixed(0)}M+ Revenue`;
                
            } catch (error) {
                console.error('Error calculating metrics:', error);
                // Keep default values if calculation fails
            }
        }
        
        // Initialize calculations when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Add small delay to ensure all scripts are loaded
            setTimeout(calculateExactMetrics, 500);
        });
    </script>
</body>
</html> 
